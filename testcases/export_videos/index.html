<!DOCTYPE HTML>
<html lang="de">
<head>
    <title>VideoChop: Test-Case Canvas</title>
    <meta charset="utf-8">
    <script src="../../videochop/js/lib/jquery-2.1.1.min.js"></script>
    <script src="canvas-to-blob.min.js"></script>
    <script src="FileSaver.js"></script>

    <style>
        body {
            background: black;
        }

        #c {
            position: relative;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
        }

        #v {
            position: absolute;
            top: 50%;
            left: 50%;
            margin: -180px 0 0 -240px;
        }
    </style>
</head>
<body>
<canvas id="c"></canvas>
<section id="video-demo">
    <video id="v" controls loop>
        <source src="../canvas/images/big_buck_bunny.mp4" type=video/mp4>
    </video>
    <h2>Saving a video</h2>
    <form id="canvas-options">
        <label>Filename: <input type="text" class="filename" id="filename" placeholder="doodle"/>.mp4</label>
        <input type="submit" value="Save"/>
    </form>
</section>
<script>


    document.addEventListener('DOMContentLoaded', function() {
        var v = document.getElementById('v');
        var canvas = document.getElementById('c');
        var context = canvas.getContext('2d');

        var cw = Math.floor(canvas.clientWidth / 100);
        var ch = Math.floor(canvas.clientHeight / 100);
        canvas.width = cw;
        canvas.height = ch;

        v.addEventListener('play', function () {
            draw(this, context, cw, ch);

        }, false);

        var form = document.getElementById('canvas-options');

        form.addEventListener('submit', function () {
            var filename = document.getElementById("filename");
            canvas.toBlob(function(blob) {
                saveAs(
                        blob,
                                (filename.value || filename.placeholder) + ".mp4"
                );
            }, "video/mp4");
        }, false);

    });

    function draw(v,c,w,h) {
        if(v.paused || v.ended) return false;
        c.drawImage(v,0,0,w,h);
        setTimeout(draw,20,v,c,w,h);
    }
</script>
</body>
</html>
