<!DOCTYPE HTML>
<html lang="de">
<head>
    <title>VideoChop: Test-Case Canvas</title>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>
    <script src="http://eruciform.com/static/jquidragcollide/jquery-collision.js"></script>
    <script src="http://eruciform.com/static/jquidragcollide/jquery-ui-draggable-collision.js"></script>
    <style>
        body {
            margin: 0;
            width: 100%;
            height: 100%;
        }
        .mainDiv {
            position: relative;
            top: 20px;
            left: 20px;
            padding: 20px;
            margin: 20px;
            background: #8c8c8c url(images/grid.jpg);
            border: 1px solid #000;
            width: 1000px;
            height: 300px;
            overflow: auto;
        }
        .sec {
            position: relative;
            width: 100%;
            height: 100px;
            outline: 1px solid #000;
        }
        #box1 {
            position: absolute;
            background-color: #ff1c2b;
            height: 100%;
            width: 20%;
            top: 0;
            left: 20%;
            z-index: 10;
        }
        #box2 {
            position: absolute;
            background-color: #4f55ff;
            height: 100%;
            width: 20%;
            top: 0;
            left: 50%;
            z-index: 10;
        }
        #box3 {
            position: absolute;
            background-color: #64ff7d;
            height: 100%;
            width: 20%;
            top: 0;
            left: 80%;
            z-index: 10;
        }
        .drop-hover {
            background: rgba(0, 150, 0, .5);
        }
    </style>
</head>
<body>
<button class="add-row">Add Row</button>
<button class="larger">larger grid</button>
<button class="smaller">smaller grid</button>
<div class="mainDiv">
    <div id="sec0" class="sec">
        <div class="collision box" id="box1"></div>
    </div>
    <div id="sec1" class="sec">
        <div class="collision box" id="box2"></div>
    </div>
    <div id="sec2" class="sec">
        <div class="collision box" id="box3"></div>
    </div>
    <div id="sec3" class="sec">

    </div>
</div>


<script>

    var $sec = $(".sec");

    console.log($sec.innerHeight());
    $(".box").draggable({
        snap: ".sec",
        obstacle: ".collision",
        preventCollision: true,
        //snapMode: "inner",
        containment: ".mainDiv",
        snapTolerance: 0,
        revert: "invalid",
        cursor: "move",
        scroll: true,
        opacity: 0.5,
        // SNAP to a 10 x 100 grid
        grid: [ 10, $sec.innerHeight() ],
        start: function( event, ui ) {
            $(this).removeClass("collision");
        },
        stop: function( event, ui ) {
            $(this).addClass("collision");
        }
    });

    $sec.droppable({
        hoverClass: "drop-hover",
        accept: ".box",
        greedy: true,
        drop: function(event, ui) {

            var targetOffset = $(event.target).offset();

            var top = targetOffset.top;
            var left = ui.draggable.position().left + targetOffset.left;

            ui.draggable.offset({
                top: top,
                left: left
            });
        }
    });

    $(".add-row").on("click", function() {
        var number = $(".sec").length;
        var newRow = $('<div id="sec'+number+'" class="sec"></div>');
        $(".mainDiv").append(newRow);
    });

    $(".larger").on("click", function() {
        var sizes = $(".box").draggable("option", "grid");
        var xSize = sizes[0];
        var ySize = sizes[1];

        var newXSize = xSize + 1;

        $(".box").draggable(
            "option", "grid", [ newXSize, ySize ]
        );
    });

    $(".smaller").on("click", function() {
        var sizes = $(".box").draggable("option", "grid");
        var xSize = sizes[0];
        var ySize = sizes[1];

        var newXSize = xSize - 1;

        if (newXSize < 1) {
            newXSize = 1;
        }

        $(".box").draggable(
                "option", "grid", [ newXSize, ySize ]
        );
    });

</script>
</body>
</html>