<!DOCTYPE HTML>
<html lang="de">
<head>
    <title>VideoChop: Test-Case Canvas</title>
    <meta charset="utf-8">
    <script src="jquery.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="jquery-collision.js"></script>
    <script src="jquery-ui-draggable-collision.js"></script>
    <link href='main.css' rel='stylesheet' type='text/css'>
    <link href='../../videochop/fonts/elegant-icons/style.css' rel='stylesheet' type='text/css'>
</head>
<body>
<button class="add-row">Add Row</button>
<button class="larger">larger grid</button>
<button class="smaller">smaller grid</button>
<div class="timeline-container">
    <div class="left-timeline">
        <label id="sec-name-0" class="sec sec-label">
            <span class="sec-delete icon_close"></span>
            <input type="text" name="sec-name-0" placeholder="add a title">
        </label>
        <label id="sec-name-1" class="sec sec-label">
            <span class="sec-delete icon_close"></span>
            <input type="text" name="sec-name-1" placeholder="add a title">
        </label>
        <label id="sec-name-2" class="sec sec-label">
            <span class="sec-delete icon_close"></span>
            <input type="text" name="sec-name-2" placeholder="add a title">
        </label>
        <label id="sec-name-3" class="sec sec-label">
            <span class="sec-delete icon_close"></span>
            <input type="text" name="sec-name-3" placeholder="add a title">
        </label>
    </div>
    <div class="right-timeline-wrapper">
        <div class="right-timeline">
            <div id="sec-item-0" class="sec sec-item">
                <div class="collision box" id="box1"></div>
            </div>
            <div id="sec-item-1" class="sec sec-item">
                <div class="collision box" id="box2"></div>
            </div>
            <div id="sec-item-2" class="sec sec-item">
                <div class="collision box" id="box3"></div>
            </div>
            <div id="sec-item-3" class="sec sec-item">

            </div>
        </div>
    </div>
</div>

<script>

    var sec = ".sec-item";
    var $sec = $(sec);
    var rightTimeline = ".right-timeline";
    var $rightTimeline = $(rightTimeline);
    var leftTimeline = ".left-timeline";
    var $leftTimeline = $(leftTimeline);

    $(".box").draggable({
        snap: sec,
        obstacle: ".collision",
        preventCollision: true,
        containment: [
            $rightTimeline.offset().left,
            $rightTimeline.offset().top,
            ($rightTimeline.offset().left + $rightTimeline.width()),
            ($rightTimeline.height())
        ],
        snapTolerance: 0,
        revert: "invalid",
        cursor: "move",
        scroll: true,
        opacity: 0.5,
        // SNAP to a 10 x 100 grid
        grid: [ 10, $sec.height() ],
        start: function() {
            $(this).removeClass("collision");
        },
        drag: function(e,u) {
            if ($rightTimeline.innerWidth() < (u.helper.position().left + u.helper.width() + 100)) {
                $rightTimeline.width(($(".right-timeline").width()+200));
            }
        },
        stop: function() {
            $(this).addClass("collision");
        }
    });

    var dropOptions = {
        hoverClass: "drop-hover",
        accept: ".box",
        greedy: true,
        drop: function(event, ui) {

            var targetOffset = $(event.target).offset();

            var top = targetOffset.top;
            var left = ui.draggable.position().left + targetOffset.left;

            ui.draggable.offset({
                top: top,
                left: left
            });
        }
    };

    $rightTimeline.children().droppable(dropOptions);

    $(".add-row").on("click", function() {
        var number = $(".sec-item").length;
        var newRow = $('<div id="sec-item-'+number+'" class="sec sec-item" />');
        newRow.droppable(dropOptions).appendTo($rightTimeline);
        var newRowLabel = $('<label id="sec-name-'+number+'" class="sec sec-label"><span class="sec-delete icon_close"></span><input type="text" name="sec-name-'+number+'" placeholder="add a title"></label>');
        $leftTimeline.append(newRowLabel);
        resizeContainment($rightTimeline);
    });

    $leftTimeline.on("click", ".sec-delete", function() {
        var $this = $(this);
        var $parent = $this.parent();
        var indexOfElem = $parent.parent().children().index($parent[0]);
        $rightTimeline.children().eq(indexOfElem).remove();
        $leftTimeline.children().eq(indexOfElem).remove();
        });

    $(".larger").on("click", function() {
        var sizes = $(".box").draggable("option", "grid");
        var xSize = sizes[0];
        var ySize = sizes[1];

        var newXSize = xSize + 1;

        $(".box").draggable(
            "option", "grid", [ newXSize, ySize ]
        );
    });

    $(".smaller").on("click", function() {
        var sizes = $(".box").draggable("option", "grid");
        var xSize = sizes[0];
        var ySize = sizes[1];

        var newXSize = xSize - 1;

        if (newXSize < 1) {
            newXSize = 1;
        }

        $(".box").draggable(
            "option", "grid", [ newXSize, ySize ]
        );
    });

    function resizeContainment($element) {
        var newContainment = [
            $element.offset().left,
            $element.offset().top,
            ($element.offset().left + $element.width()),
            ($element.height() + $element.offset().top)
        ];

        $(".box").draggable("option", "containment", newContainment);
    }

    $(window).on("resize orientationchange", function() {
        resizeContainment($rightTimeline);
    });

</script>
</body>
</html>